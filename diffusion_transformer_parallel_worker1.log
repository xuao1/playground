Testing with worker_num=1
Running iteration 1 with worker_num=1...
/workspace/xformers/playground/../../repos/x-transformers/x_transformers/x_transformers.py:439: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  @autocast(enabled = False)
/workspace/xformers/playground/../../repos/x-transformers/x_transformers/x_transformers.py:461: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  @autocast(enabled = False)
Namespace(query_interval=1, input_seq_len=8, encoder_n=1, prefill_n=1, decode_n=1, encoder_len=1, prefill_len=1, decode_len=6, simu_ts_len=500, real_run=True, enable_recompute=False, mode='parallel_v2', req_interval=0.0221, model='diffusion_transformer', dim=512, enable_slice=False, warmup_num=10, trail_num=20, profile_mode='flashinfer', only_profile=False, num_trails=200, worker_num=1, verbose=0, config='./config_parallel.yaml', diffusion_step=100, diffusion_stage_num=5, input_img_num=4, input_img_size=84, input_traj_cnn_size=16, input_traj_transformer_size=10, input_cond_size=274, input_dim=20, cond_dim=274, n_emb=768, global_cond_dim=548, perception_scale=1.0, generation_scale=1.0)
Start DiffusionPolicy inference...
Perception params: 1.168951e+07
Generation params: 8.059087e+07
====== Graph for resnet generated ======
Warning: /usr/local/lib/python3.10/dist-packages/torch/nn/modules/transformer.py changed
Warning: /usr/local/lib/python3.10/dist-packages/torch/nn/modules/transformer.py changed
====== Graph for backbone generated ======
Query latency: 5107.955 ms
Query duration: 78.353
Throughput: 12.763
DiffusionPolicy inference finished.
Iteration 1 completed.
--------------------------------------
Running iteration 2 with worker_num=1...
/workspace/xformers/playground/../../repos/x-transformers/x_transformers/x_transformers.py:439: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  @autocast(enabled = False)
/workspace/xformers/playground/../../repos/x-transformers/x_transformers/x_transformers.py:461: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  @autocast(enabled = False)
Namespace(query_interval=1, input_seq_len=8, encoder_n=1, prefill_n=1, decode_n=1, encoder_len=1, prefill_len=1, decode_len=6, simu_ts_len=500, real_run=True, enable_recompute=False, mode='parallel_v2', req_interval=0.0221, model='diffusion_transformer', dim=512, enable_slice=False, warmup_num=10, trail_num=20, profile_mode='flashinfer', only_profile=False, num_trails=200, worker_num=1, verbose=0, config='./config_parallel.yaml', diffusion_step=100, diffusion_stage_num=5, input_img_num=4, input_img_size=84, input_traj_cnn_size=16, input_traj_transformer_size=10, input_cond_size=274, input_dim=20, cond_dim=274, n_emb=768, global_cond_dim=548, perception_scale=1.0, generation_scale=1.0)
Start DiffusionPolicy inference...
Perception params: 1.168951e+07
Generation params: 8.059087e+07
====== Graph for resnet generated ======
Warning: /usr/local/lib/python3.10/dist-packages/torch/nn/modules/transformer.py changed
Warning: /usr/local/lib/python3.10/dist-packages/torch/nn/modules/transformer.py changed
====== Graph for backbone generated ======
Query latency: 5026.465 ms
Query duration: 78.349
Throughput: 12.763
DiffusionPolicy inference finished.
Iteration 2 completed.
--------------------------------------
Running iteration 3 with worker_num=1...
/workspace/xformers/playground/../../repos/x-transformers/x_transformers/x_transformers.py:439: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  @autocast(enabled = False)
/workspace/xformers/playground/../../repos/x-transformers/x_transformers/x_transformers.py:461: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  @autocast(enabled = False)
Namespace(query_interval=1, input_seq_len=8, encoder_n=1, prefill_n=1, decode_n=1, encoder_len=1, prefill_len=1, decode_len=6, simu_ts_len=500, real_run=True, enable_recompute=False, mode='parallel_v2', req_interval=0.0221, model='diffusion_transformer', dim=512, enable_slice=False, warmup_num=10, trail_num=20, profile_mode='flashinfer', only_profile=False, num_trails=200, worker_num=1, verbose=0, config='./config_parallel.yaml', diffusion_step=100, diffusion_stage_num=5, input_img_num=4, input_img_size=84, input_traj_cnn_size=16, input_traj_transformer_size=10, input_cond_size=274, input_dim=20, cond_dim=274, n_emb=768, global_cond_dim=548, perception_scale=1.0, generation_scale=1.0)
Start DiffusionPolicy inference...
Perception params: 1.168951e+07
Generation params: 8.059087e+07
====== Graph for resnet generated ======
Warning: /usr/local/lib/python3.10/dist-packages/torch/nn/modules/transformer.py changed
Warning: /usr/local/lib/python3.10/dist-packages/torch/nn/modules/transformer.py changed
====== Graph for backbone generated ======
Query latency: 5082.265 ms
Query duration: 78.361
Throughput: 12.761
DiffusionPolicy inference finished.
Iteration 3 completed.
--------------------------------------
Running iteration 4 with worker_num=1...
/workspace/xformers/playground/../../repos/x-transformers/x_transformers/x_transformers.py:439: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  @autocast(enabled = False)
/workspace/xformers/playground/../../repos/x-transformers/x_transformers/x_transformers.py:461: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  @autocast(enabled = False)
Namespace(query_interval=1, input_seq_len=8, encoder_n=1, prefill_n=1, decode_n=1, encoder_len=1, prefill_len=1, decode_len=6, simu_ts_len=500, real_run=True, enable_recompute=False, mode='parallel_v2', req_interval=0.0221, model='diffusion_transformer', dim=512, enable_slice=False, warmup_num=10, trail_num=20, profile_mode='flashinfer', only_profile=False, num_trails=200, worker_num=1, verbose=0, config='./config_parallel.yaml', diffusion_step=100, diffusion_stage_num=5, input_img_num=4, input_img_size=84, input_traj_cnn_size=16, input_traj_transformer_size=10, input_cond_size=274, input_dim=20, cond_dim=274, n_emb=768, global_cond_dim=548, perception_scale=1.0, generation_scale=1.0)
Start DiffusionPolicy inference...
Perception params: 1.168951e+07
Generation params: 8.059087e+07
====== Graph for resnet generated ======
Warning: /usr/local/lib/python3.10/dist-packages/torch/nn/modules/transformer.py changed
Warning: /usr/local/lib/python3.10/dist-packages/torch/nn/modules/transformer.py changed
====== Graph for backbone generated ======
Query latency: 5076.225 ms
Query duration: 78.287
Throughput: 12.773
DiffusionPolicy inference finished.
Iteration 4 completed.
--------------------------------------
Running iteration 5 with worker_num=1...
/workspace/xformers/playground/../../repos/x-transformers/x_transformers/x_transformers.py:439: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  @autocast(enabled = False)
/workspace/xformers/playground/../../repos/x-transformers/x_transformers/x_transformers.py:461: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  @autocast(enabled = False)
Namespace(query_interval=1, input_seq_len=8, encoder_n=1, prefill_n=1, decode_n=1, encoder_len=1, prefill_len=1, decode_len=6, simu_ts_len=500, real_run=True, enable_recompute=False, mode='parallel_v2', req_interval=0.0221, model='diffusion_transformer', dim=512, enable_slice=False, warmup_num=10, trail_num=20, profile_mode='flashinfer', only_profile=False, num_trails=200, worker_num=1, verbose=0, config='./config_parallel.yaml', diffusion_step=100, diffusion_stage_num=5, input_img_num=4, input_img_size=84, input_traj_cnn_size=16, input_traj_transformer_size=10, input_cond_size=274, input_dim=20, cond_dim=274, n_emb=768, global_cond_dim=548, perception_scale=1.0, generation_scale=1.0)
Start DiffusionPolicy inference...
Perception params: 1.168951e+07
Generation params: 8.059087e+07
====== Graph for resnet generated ======
Warning: /usr/local/lib/python3.10/dist-packages/torch/nn/modules/transformer.py changed
Warning: /usr/local/lib/python3.10/dist-packages/torch/nn/modules/transformer.py changed
====== Graph for backbone generated ======
Query latency: 5073.412 ms
Query duration: 78.399
Throughput: 12.755
DiffusionPolicy inference finished.
Iteration 5 completed.
--------------------------------------
All iterations for worker_num=1 are complete. Output saved to diffusion_transformer_parallel_worker1.log.
Average Query Duration: 78.3498 ms (0.07834980 seconds)
Throughput: 12.76327444 requests/second
====================================
